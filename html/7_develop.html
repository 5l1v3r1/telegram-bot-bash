<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>Bashobot Documentation - 7_develop.html</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
</head>
<body>
<div id="header">
<h1 class="title">Bashobot Documentation - 7_develop.html</h1>
</div>
<h4 id="home"><a href="../README.html">Home</a></h4>
<h2 id="notes-for-bashbot-developers">Notes for bashbot developers</h2>
<p>This section is about help and best practices for new bashbot developers. The main focus on is creating new versions of bashbot, not on develop your individual bot. Nevertheless the rules and tools described here can also help you with your bot development.</p>
<p>bashbot development is done on github. If you want to provide fixes or new features <a href="https://help.github.com/en/articles/fork-a-repo">fork bashbot on githup</a> and provide changes as <a href="https://help.github.com/en/articles/creating-a-pull-request">pull request on github</a>.</p>
<h3 id="setup-your-develop-environment">Setup your develop environment</h3>
<ol style="list-style-type: decimal">
<li>install git, install <a href="5_practice.md#Test-your-Bot-with-shellcheck">shellcheck</a></li>
<li>setup your <a href="4_expert.md#Setting-up-your-Environment">environment for UTF-8</a></li>
<li>clone your bashbot fork to a new directory <code>git clone https://github.com/&lt;YOURNAME&gt;/telegram-bot-bash.git</code>, replace <code>&lt;YOURNAME&gt;</code> with your username on github</li>
<li>create and change to your develop branch <code>git checkout -b &lt;YOURBRANCH&gt;</code>, replace <code>&lt;YOURBRANCH&gt;</code> with the name you want to name it, e.g. ‘develop’</li>
<li>give your (dev) fork a new version tag: <code>git tag vx.xx</code>, version must be higher than current version</li>
<li>setup github hooks by running <code>dev/install-hooks.sh</code> (optional)</li>
</ol>
<h3 id="test-add-push-changes">Test, Add, Push changes</h3>
<p>A typical bashbot develop loop looks as follow:</p>
<ol style="list-style-type: decimal">
<li>start developing - <em>change, copy, edit bashbot files …</em></li>
<li>after changing a bash sript: <code>shellcheck -x scipt.sh</code></li>
<li><code>dev/all-tests.sh</code> - <em>in case if errors back to 2.</em></li>
<li><code>dev/git-add.sh</code> - <em>check for changed files, update version string, run git add</em></li>
<li><code>git commit' -m &quot;COMMIT MESSAGE&quot;; git push</code></li>
</ol>
<p><strong>If you setup iyou dev environment with hooks and use the scripts above, versioning, addding and testing is done automatically.</strong></p>
<h3 id="prepare-a-new-version">Prepare a new version</h3>
<p>After some development it may time to create a new version for the users. a new version can be in sub version upgrade, e.g. for fixes and smaller additions or a new release version for new features. To mark a new version use <code>git tag NEWVERSION</code> and run <code>dev/version.sh</code> to update all version strings.</p>
<p>Usually I start with pre versions and when everything looks good I push out a release candidate (rc) and finally the new version.</p>
<pre><code> v0.x-devx -&gt; v0.x-prex -&gt; v0.x-rc -&gt; v0.x  ... 0.x+1-dev ...</code></pre>
<h3 id="versioning">Versioning</h3>
<p>Bashbot is tagged with version numbers. If you start a new development cycle you must tag your fork with a version higher than the current version. E.g. if you fork ‘v0.60’ the next develop version should tagged as <code>git tag &quot;v0.61-dev&quot;</code> for fixes or <code>git tag &quot;v0.70-dev&quot;</code> for new features.</p>
<p>To get the current version name of your develepment fork run <code>git describe --tags</code>. The output looks like <code>v0.70-dev-6-g3fb7796</code> where your version tag is followed by the number of commits since you tag your branch and followed by the latest commit hash. see also <a href="../dev/version.sh">comments in version.sh</a></p>
<p>To update the Version Number in your scripts run <code>dev/version.sh</code>, it will update the line ‘#### <br /><span class="math display"><em>V</em><em>E</em><em>R</em><em>S</em><em>I</em><em>O</em><em>N</em></span><br /> ###’ in all files to the current version name.</p>
<h3 id="shellchecking">Shellchecking</h3>
<p>For a shell script running as a service it’s important to be paranoid about quoting, globbing and other common problems. So it’s a must to run shellchek on all shell scripts before you commit a change. this is automated by a git hook activated in Setup step 6.</p>
<p>In addition you can run <code>dev/hooks/pre-commit.sh</code> every time you want to shellcheck all files given in ‘dev/shellcheck.files’.</p>
<h2 id="bashbot-tests">bashbot tests</h2>
<p>Starting with version 0.70 bashbot has a test suite. To start testsuite run <code>dev/all-tests.sh</code>. all-tests.sh will return ‘SUCCESS’ only if all tests pass.</p>
<h3 id="enabling-disabling-tests">enabling / disabling tests</h3>
<p>All tests are placed in the directory <code>test</code>. To disable a test remove the x flag from the ’*-test.sh’ test script, to (re)enable a test make the script executable again.</p>
<h3 id="creating-new-tests">creating new tests</h3>
<p>To create a new test run <code>test/ADD-test-new.sh</code> and answer the questions, afterwards you have the following described files and dirs:</p>
<p>Each test consists of a script script named like <code>p-name-test.sh</code> <em>(where p is test pass ‘a-z’ and name the name of your test)</em> and an optional dir <code>p-name-test/</code> <em>(script name minus ‘.sh’)</em> for additional files.</p>
<p>The file <code>ALL-tests.inc.sh</code> must be included from all tests, do not forget the shellcheck source directive to statisfy shellcheck.</p>
<p>Tests with no dependency to other tests will run in pass ‘a’, tests which need an initialized bahsbot environment must run in pass ‘d’ or later. If ‘$1’ is present the script is started from ‘ALL-tests.sh’ and a temporary test environment is setup in directory ‘$1’. The temporary test environment is created when ‘ALL-tests.sh’ starts and deleted after all tests are finished.</p>
<p>Example test</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="co">#!/usr/bin/env bash</span>
<span class="co"># file: b-example-test.sh</span>

<span class="co"># include common functions and definitions</span>
<span class="co"># shellcheck source=test/ALL-tests.inc.sh</span>
<span class="bu">source</span> <span class="st">&quot;./ALL-tests.inc.sh&quot;</span>

<span class="kw">if</span><span class="bu"> [</span> <span class="ot">-f</span> <span class="st">&quot;bashbot.sh&quot;</span><span class="bu"> ]</span>; <span class="kw">then</span>
    <span class="bu">echo</span> <span class="st">&quot;</span><span class="va">${SUCCESS}</span><span class="st"> bashbot.sh exist!&quot;</span>
    <span class="bu">exit</span> 0
<span class="kw">else</span>
    <span class="bu">echo</span> <span class="st">&quot;</span><span class="va">${NOSUCCESS}</span><span class="st"> bashbot.sh missing!&quot;</span>
    <span class="bu">exit</span> 1
<span class="kw">fi</span></code></pre></div>
<h4 id="prev-function-reference"><a href="6_function.html">Prev Function Reference</a></h4>
<h4 id="next-bashbot-environment"><a href="8_custom.html">Next Bashbot Environment</a></h4>
<h4 id="version-v0.70-pre1-7-g02d9afb"><br /><span class="math display"><em>V</em><em>E</em><em>R</em><em>S</em><em>I</em><em>O</em><em>N</em></span><br /> v0.70-pre1-7-g02d9afb</h4>
</body>
</html>
